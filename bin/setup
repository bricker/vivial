#!/usr/bin/env bash

source ./develop/python/functions.bash

statusmsg -ns "Hi! Welcome to Eave. I will help you setup this repository."

echo ""

usershell=$(shellname)

if [[ -z "$EAVE_HOME" ]]
then
  case $usershell in
  	"bash" | "zsh")
  		case $usershell in
  			"bash") loginfile=~/.bashrc ;;
  			"zsh") loginfile=~/.zshrc ;;
  		esac
  		varcmd="export EAVE_HOME=\"$(pwd)\""
  		statusmsg -ni "First, I'll add the following line to $loginfile:"
  		echo ""
  		statusmsg -o "\t$varcmd"
  		echo ""
  
  		read -p "Should I proceed? [y/n] " proceed
  		if test "$proceed" = "y"
  		then
  			echo -e "\n$varcmd" >> "$loginfile"
  		fi
  
      statusmsg "Updating current shell to set EAVE_HOME"
      source "$loginfile"
  		;;
  	"fish")
  		varcmd="set -Ux EAVE_HOME $(pwd)"
  		statusmsg -ni "First, I'll add a Universal variable to your Fish environment with the following command:"
  		echo ""
  		echo -e "\t$varcmd"
  		echo ""
  
  		read -p "Should I proceed? [y/n] " proceed
  		if test "$proceed" = "y"
  		then
  			fish -c "$varcmd"
  		fi
  		;;
  	*)
  		statusmsg -w "Your shell ($usershell) isn't supported by this script. Please update this script to add support!"
  		;;
  esac
else
  statusmsg -ni "EAVE_HOME already set. Continuing..."
fi

echo ""

statusmsg -ni "Next, I'm going to visit each of the app and lib directories and run the setup script for each one."

read -p "Should I proceed? [y/n] " proceed
if test "$proceed" = "y"
then
  # install airbnb-base dep for shared eslint config
  statusmsg -ni "Setting up shared dev dependencies"
  cd ${EAVE_HOME}/develop/javascript/eslint/
  bin/setup
  cd - > /dev/null

  # setup python dev dep
	python-activate-venv
	python -m pip install python-dotenv

	run_in_all_projects bin/setup
fi

statusmsg -s "Done!"

statusmsg -i "Now, open the file .vscode/eave.code-workspace in VSCode, and you're ready to go."
