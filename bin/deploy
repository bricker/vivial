#!/usr/bin/env bash

set -eu

source ${EAVE_HOME}/develop/functions.bash

function deploy() (
	local OPTIND OPTARG argname

	local appdir=""
	local revision=""

	while getopts "a:r:" argname
	do
		case "$argname" in
			a) appdir=$OPTARG ;;
			r) revision=$OPTARG ;;
		esac
	done

	cd $(mktemp -d)
	git clone --depth=1 git@github.com:eave-fyi/eave-monorepo.git .
	git checkout $revision
	gcloud builds submit --ignore-file=.gcloudignore-builder --config=$appdir/cloudbuild.yaml
	# ${EAVE_HOME}/develop/python/bin/deploy-appengine
)

deploy