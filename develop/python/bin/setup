#!/usr/bin/env bash

set -eu

source ${EAVE_HOME}/develop/functions.bash

function run () (
	python-validate-version
	python-activate-venv

	local piploc=""
	if test -n "${CI:-}"; then
		piploc="--user"
	fi

	local qflag="-q -q"
	if verbose; then
		qflag=""
	fi

	local eavepwd=$(~eavepwd)
	statusmsg -in "Setting up python in $eavepwd..."

	python -m pip install $qflag $piploc \
		-r ${EAVE_HOME}/develop/requirements-dev.txt \
		-r ${EAVE_HOME}/develop/python/requirements-dev.txt \
		-r ${EAVE_HOME}/libs/eave-stdlib-py/requirements-dev.txt \
		-r ${EAVE_HOME}/libs/eave-pubsub-schemas/requirements-dev.txt

	if test -f requirements.txt
	then
		python -m pip install $qflag $piploc -r requirements.txt
	fi

	if test -f requirements-dev.txt
	then
		python -m pip install $qflag $piploc -r requirements-dev.txt
	fi

	statusmsg -sp " âœ” "
)

run