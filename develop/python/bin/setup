#!/usr/bin/env bash

set -eu

source "${EAVE_HOME}"/develop/functions.bash

function setup() (
	python-validate-version
	python-activate-venv

	local piploc=""
	if ^ci; then
		piploc="--user"
	fi

	local qflag="-q -q"
	if verbose; then
		qflag=""
	fi

	local eavepwd
	eavepwd=$(^eavepwd)
	statusmsg -on "Setting up python in $eavepwd..."

	# shellcheck disable=SC2086
	python -m pip install $qflag $piploc \
		-r "${EAVE_HOME}"/develop/requirements-dev.txt \
		-r "${EAVE_HOME}"/develop/python/requirements-dev.txt \
		-r "${EAVE_HOME}"/libs/eave-stdlib-py/requirements-dev.txt \
		-r "${EAVE_HOME}"/libs/eave-pubsub-schemas/requirements-dev.txt

	if test -f requirements.txt; then
		# shellcheck disable=SC2086
		python -m pip install $qflag $piploc -r requirements.txt
	fi

	if test -f requirements-dev.txt; then
		# shellcheck disable=SC2086
		python -m pip install $qflag $piploc -r requirements-dev.txt
	fi

	statusmsg -sp " âœ” "
)

setup
