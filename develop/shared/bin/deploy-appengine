#!/usr/bin/env bash

set -eu

source $EAVE_HOME/develop/functions.bash

(
	local appyaml="app.$GOOGLE_CLOUD_PROJECT.yaml"
	local timestamp=$(date --utc "+%Y%m%dt%H%Mz")
	local gitrev=$(git rev-parse --short HEAD)
	local version="$timestamp-$gitrev"
	gcloud app deploy --version=$version --appyaml=$appyaml

	# local service=$(cat $appyaml | yq '.service')
	# local tagname="$service-$version"
	# git tag -am $tagname $tagname
	# git push origin $tagname
)
