#!/usr/bin/env bash

set -eu

source "${EAVE_HOME}"/develop/functions.bash

function main() (
	e.verify_clean_git_index

	export EAVE_DEPLOY_TARGET
	EAVE_DEPLOY_TARGET="$(e.gcloudproject)"

	cd "$(e.parentpath)"
	bin/lint

	statusmsg -a "Diff since last deployment:"
	bin/diff-prod

	statusmsg -a "Deploy target: ${EAVE_DEPLOY_TARGET}"

	if e.confirm; then
		"${EAVE_HOME}"/develop/deploy/bin/deploy-service -s dashboard
	fi
)

main "$@"
