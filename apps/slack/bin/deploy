#!/usr/bin/env bash

set -eu

source ${EAVE_HOME}/develop/functions.bash

function deploy () (
	local usage="Usage: deploy [-t (skips tests)]"
	local skiptests=""

	while getopts "th" argname
	do
		case "$argname" in
			t) skiptests="1" ;;
			h)
				echo $usage
				exit 0
				;;
		esac
	done

	bin/lint

	if test -z "$skiptests"; then
		bin/test
	else
		statusmsg -w "Skipping tests (-t flag passed)"
	fi

	setup-deployment-workspace
	${EAVE_HOME}/develop/python/bin/deploy-appengine
	clean-deployment-workspace
)

deploy "$@"
